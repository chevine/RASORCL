-- The rental income reported by the landlord and the rental payments
-- to the landlord are equal  to each under.
INSERT INTO RAS.RAS_TENANT_PAYMENT_HISTORY(
    TAX_YEAR, TENANT_TAX_ID, PROPERTY_ID, TOTAL_PAYMENTS
)
SELECT rhu.TAX_YEAR AS TAX_YEAR
, rhu.TAXID AS TENANT_TAX_ID
, rhu.PROPERTY_ID AS PROPERTY_ID
, 0 AS TOTAL_PAYMENTS
FROM RAS.RAS_HOUSEHOLD_UNIT rhu
LEFT JOIN RAS.RAS_TENANT_PAYMENT_HISTORY rtph ON (rtph.TAX_YEAR = rhu.TAX_YEAR AND rtph.TENANT_TAX_ID = rhu.TAXID)
WHERE rtph.TAX_YEAR IS NULL

UPDATE RAS_TENANT_PAYMENT_HISTORY rtph
SET TOTAL_PAYMENTS = ( 
    SELECT rp.RENTAL_INCOME_RECEIVED
    FROM RAS.RAS_PROPERTY rp WHERE rp.TAX_YEAR = rtph.TAX_YEAR AND rp.PROPERTY_ID = rtph.PROPERTY_ID
    FETCH FIRST ROW ONLY
)
WHERE rtph.TOTAL_PAYMENTS = 0;

